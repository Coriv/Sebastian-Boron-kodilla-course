CREATE VIEW BESTSELLER_COUNT AS
    SELECT COUNT(*) AS BESTSELLER_COUNTER FROM BOOKS WHERE BESTSELLER = 1;

DELIMITER $$
CREATE PROCEDURE UpdateStatsTable()
BEGIN
    DECLARE quantity int(11);
    SELECT * FROM BESTSELLER_COUNT
        INTO quantity;

    INSERT INTO STATS(STAT_DATE, STAT, VALUE)
        VALUE (CURTIME(), "BESTSELLERS", quantity);
end ;
DELIMITER ;


CREATE EVENT UpdateStatusAndSaveResult
ON SCHEDULE EVERY 1 MINUTE
DO
    BEGIN
    CALL UpdateBestsellerStatus();
    CALL UpdateStatsTable();
end;
